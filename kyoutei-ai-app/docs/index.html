<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kyotei AI</title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="KyoteiAI">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <style>
        /* iOSãƒ©ã‚¤ã‚¯ãªUI [cite: 110-131] */
        :root { --primary: #0055aa; --rough: #d63031; --solid: #00b894; --bg: #f5f6fa; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; -webkit-tap-highlight-color: transparent; }
        header { background: var(--primary); color: white; padding: 15px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { margin: 0; font-size: 18px; text-align: center; font-weight: 600; }
        .container { max-width: 600px; margin: 0 auto; padding: 10px; }
        .race-card { background: white; border-radius: 12px; margin-bottom: 15px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .race-header { padding: 10px 15px; background: #f1f2f6; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #e1e1e1; }
        .stadium-badge { font-weight: bold; color: #2d3436; }
        .race-num { background: #2d3436; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; }
        .logic-tag { display: inline-block; font-size: 10px; padding: 3px 6px; border-radius: 4px; margin-left: 10px; color: white; }
        .logic-SOLID { background: var(--solid); }
        .logic-ROUGH { background: var(--rough); }
        .prediction-area { padding: 15px; }
        .bet-row { font-family: 'Courier New', monospace; font-size: 18px; font-weight: bold; color: #2d3436; margin: 5px 0; display: flex; align-items: center; }
        .bet-icon { margin-right: 10px; font-size: 14px; }
        .fab { position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: white; width: 56px; height: 56px; border-radius: 50%; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 10px rgba(0,85,170,0.4); cursor: pointer; font-size: 24px; border: none; }
    </style>
</head>
<body>
<header><h1>ç«¶è‰‡AIäºˆæƒ³ (Beta)</h1></header>
<div class="container" id="app">
    <div style="text-align:center; padding: 50px; color: #b2bec3;">Loading Data...</div>
</div>
<button class="fab" onclick="fetchData()">â†»</button>

<script>
    async function fetchData() {
        const app = document.getElementById('app');
        try {
            const timestamp = new Date().getTime();
            // GitHub Pagesã®JSONã‚’å–å¾—
            const res = await fetch(`data/latest_odds.json?t=${timestamp}`);
            if (!res.ok) throw new Error("ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—");
            const data = await res.json();
            renderApp(data);
        } catch (e) {
            console.error(e);
            app.innerHTML = `<div style="padding:20px; text-align:center; color:var(--rough);">ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¨ãƒ©ãƒ¼<br>ã¾ã ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ãŒç”Ÿæˆã•ã‚Œã¦ã„ãªã„ã‹ã€é€šä¿¡ç’°å¢ƒãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>`;
        }
    }

    function renderApp(data) {
        const app = document.getElementById('app');
        let html = '';
        const stadiumKeys = Object.keys(data).sort();
        if (stadiumKeys.length === 0) {
            app.innerHTML = '<div style="text-align:center; padding:40px;">æœ¬æ—¥ã®é–‹å‚¬ãƒ‡ãƒ¼ã‚¿ãªã—</div>';
            return;
        }
        stadiumKeys.forEach(jcd => {
            const races = data[jcd];
            races.forEach(race => {
                html += `
                <div class="race-card">
                    <div class="race-header">
                        <div>
                            <span class="stadium-badge">å ´ã‚³ãƒ¼ãƒ‰: ${jcd}</span>
                            <span class="logic-tag logic-${race.prediction_logic}">${race.prediction_logic}</span>
                        </div>
                        <span class="race-num">${race.race_no}R</span>
                    </div>
                    <div class="prediction-area">
                        ${race.predictions.map((p, i) => 
                         `<div class="bet-row"><span class="bet-icon">${i===0? 'ğŸ¯' : 'âš ï¸'}</span>${p}</div>`
                        ).join('')}
                    </div>
                </div>`;
            });
        });
        app.innerHTML = html;
    }

    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }
    fetchData();
</script>
</body>
</html>